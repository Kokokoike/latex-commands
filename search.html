<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - LaTeX Dictionary</title>
    <link rel="icon" href="images/icon_site.svg" type="image/svg+xml" sizes="any">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="js/utils.js"></script>
    <link rel="stylesheet" href="css/style.css">

    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            /* 検索結果ページ用のスタイル */
            justify-content: flex-start;
            padding-bottom: 40px;
        }

        .container { width: 90%; max-width: 800px; padding: 20px; margin: auto; margin-top: 0; }
        
        .site-logo-img {
            max-width: 150px;
            height: auto;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.08));
            cursor: pointer;
        }

        .copy-btn-small {
            margin-left: 10px;
        }

        /* 検索バーの幅をリスト表示に合わせる */
        .view-controls,
        .main-results-list:not(.grid-view) {
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <header class="top-header"></header>

    <div class="container">
        <h2 style="text-align:left; margin: 20px 0; color:#444;">Search Results: "<span id="query-text"></span>"</h2>
        
        <!-- 表示切り替えボタン -->
        <div class="view-controls" id="view-controls">
            <button class="view-btn active" id="btn-list" title="List View">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <rect x="4" y="5" width="3" height="3" rx="1"></rect><rect x="9" y="5" width="10" height="3" rx="1"></rect><rect x="4" y="10" width="3" height="3" rx="1"></rect><rect x="9" y="10" width="10" height="3" rx="1"></rect><rect x="4" y="15" width="3" height="3" rx="1"></rect><rect x="9" y="15" width="10" height="3" rx="1"></rect>
                </svg>
            </button>
            <button class="view-btn" id="btn-grid" title="Grid View">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <rect x="4" y="4" width="7" height="7" rx="1"></rect><rect x="13" y="4" width="7" height="7" rx="1"></rect><rect x="4" y="13" width="7" height="7" rx="1"></rect><rect x="13" y="13" width="7" height="7" rx="1"></rect>
                </svg>
            </button>
        </div>

        <div class="main-results-list" id="main-results-list"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            if (window.renderCommonHeader) window.renderCommonHeader();
            await window.initDatabase();

            const params = new URLSearchParams(window.location.search);
            const query = params.get('q');
            document.getElementById('query-text').innerText = query || "";
            const mainList = document.getElementById('main-results-list');
            mainList.innerHTML = '';

            // 表示切り替え機能
            const btnList = document.getElementById('btn-list');
            const btnGrid = document.getElementById('btn-grid');
            
            btnList.addEventListener('click', () => {
                mainList.classList.remove('grid-view');
                btnList.classList.add('active');
                btnGrid.classList.remove('active');
            });
            btnGrid.addEventListener('click', () => {
                mainList.classList.add('grid-view');
                btnGrid.classList.add('active');
                btnList.classList.remove('active');
            });

            if (!query) return;

            const results = window.performSearch(query);

            if (results.length === 0) {
                mainList.innerHTML = '<div style="color:#666; padding:20px;">No results found.</div>';
            } else {
                results.forEach(item => {
                    const key = item.key;
                    const data = item.data;
                    
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    const safeId = 'search-res-' + key.replace(/[^a-zA-Z0-9]/g, '');

                    div.innerHTML = `
                        <div class="list-preview" id="${safeId}"></div>
                        <div class="list-info">
                            <div class="cmd-row">
                                <div class="result-cmd">${key}</div>
                                <button class="copy-btn-small">Copy</button>
                            </div>
                            <div class="result-desc">${data.description || ''}</div>
                        </div>
                    `;
                    
                    const copyBtn = div.querySelector('.copy-btn-small');
                    copyBtn.onclick = (e) => {
                        e.stopPropagation();
                        window.copyText(copyBtn, key);
                    };

                    div.onclick = () => location.href = `detail1.html?id=${encodeURIComponent(key)}`;
                    mainList.appendChild(div);

                    window.renderMath(safeId, key);
                });
            }
        });
    </script>
</body>
</html>